<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Schedule</title>
    <link rel="stylesheet" href="styles.css?v=1.1" />
    <link rel="shortcut icon" href="images/favicon.png" type="image/x-icon" />
    <link rel="icon" href="images/favicon.png" type="image/x-icon" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Spectral:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;0,800;1,200;1,300;1,400;1,500;1,600;1,700;1,800&display=swap" rel="stylesheet" />
</head>

<body class="sched">
<header>
    <a href="#" class="logo"><img src="images/calicehockeylogo2.png" alt="California" /></a>
    <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="schedule.html">Schedule</a></li>
        <li><a href="roster.html">Roster</a></li>
        <li><a href="staff.html">Staff</a></li>
        <li><a href="articles.html">Articles</a></li>
        <li class="dropdown">
            <a href="login.php">Team</a>
            <ul class="dropdown-menu">
                <li><a href="login.php">Login</a></li>
                <li><a href="https://forms.gle/nP5RbMVFuc2RLnWz9" target="_blank">Recruits</a></li>
                <li><a href="https://forms.gle/iUhuvuu1Cd8nx1Cd6" target="_blank">Alumni</a></li>
            </ul>
        </li>
    </ul>
</header>

<script>
    window.addEventListener("scroll", function () {
      const header = document.querySelector("header");
      header.classList.toggle("sticky", window.scrollY > 0);
    });
</script>

<div class="timeline" id="timeline"></div>

<!-- <img class="parallaxbackground" src="images/ScheduleBackground.jpg"> -->

<section class="bottom homeBottom">
    <section class="socialmediacontainer">
        <div class="FollowUs">Follow Us:</div>
        <div>
            <a href="https://www.instagram.com/calicehockey/?utm_source=ig_web_button_share_sheet&igshid=OGQ5ZDc2ODk2ZA==" target="_blank">
                <img src="images/new-instagram-logo-white-border-icon-png-large.png" alt="Intagram" />
            </a>
        </div>
        <div>
            <a href="https://www.tiktok.com/@californiaicehockey" target="_blank">
                <img src="images/tiktok-round-white-icon.webp" alt="TikTok" />
            </a>
        </div>
        <div>
            <a href="https://x.com/Cal_IceHockey" target="_blank">
                <img src="images/x-social-media-white-round-icon.png" alt="X" />
            </a>
        </div>
    </section>
</section>

<script>
    // (kept from your original)
    document.addEventListener("click", function (e) {
      const btn = e.target.closest(".dropdown-toggle");
      document.querySelectorAll(".dropdown-menu").forEach((menu) => (menu.style.display = "none"));

      if (btn) {
        const menu = btn.parentElement.querySelector(".dropdown-menu");
        if (menu) menu.style.display = "flex";
      }
    });
</script>

<script>
    const TIMELINE_ID = "timeline";
    const JSON_PATH = "schedule.json"; // put schedule.json next to schedule.html

    function escapeHtml(str) {
      return String(str ?? "")
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#039;");
    }

    function renderGame(game) {
      const side = (game.side || "left").toLowerCase() === "right" ? "right" : "left";

      const containerClass =
        side === "right"
          ? "timelineContainer timelineRight-container"
          : "timelineContainer timelineLeft-container";

      const arrowClass = side === "right" ? "right-container-arrow" : "left-container-arrow";

      const opponent = escapeHtml(game.opponent);
      const datetimeText = escapeHtml(game.datetimeText);
      const locationText = escapeHtml(game.locationText);
      const scoreText = escapeHtml(game.scoreText);

      const logo = escapeHtml(game.logo);

      // Keep exact markup structure you had (img + textbox + span arrow + a Watch)
      // If watchUrl is empty, we still render <a href="">Watch</a> like your file.
      const watchUrl = escapeHtml(game.watchUrl || "");

      return `
        <div class="${containerClass}">
          <img src="${logo}">
          <div class="textbox">
            <h2 class="blackText">${opponent}</h2>
            <h4>${datetimeText}</h4>
            <p>${locationText}</p>
            <p>${scoreText}</p>
            <span class="${arrowClass}"></span>
            <a href="${watchUrl}">Watch</a>
          </div>
        </div>
      `;
    }

    async function loadSchedule() {
      const timeline = document.getElementById(TIMELINE_ID);
      if (!timeline) return;

      try {
        const res = await fetch(JSON_PATH, { cache: "no-store" });
        if (!res.ok) throw new Error(`Failed to load ${JSON_PATH}: ${res.status}`);

        const data = await res.json();
        const games = Array.isArray(data.games) ? data.games : [];

        timeline.innerHTML = games.map(renderGame).join("");
      } catch (err) {
        console.error(err);
        timeline.innerHTML = `
          <div style="padding: 20px;">
            <p style="color: white;">Could not load schedule.</p>
          </div>
        `;
      }
    }

    loadSchedule();
</script>
</body>
</html>
